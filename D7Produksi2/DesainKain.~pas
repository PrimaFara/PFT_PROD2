unit DesainKain;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Grids, Wwdbigrd, Wwdbgrid, ExtCtrls, StdCtrls, Wwdbcomb, DB,
  OracleData, wwDialog, wwidlg, Wwdatsrc, wwSpeedButton, wwDBNavigator,
  wwclearpanel, DBCtrls, wwdbedit, wwdbdatetimepicker, Mask, Wwdotdot,
  ComCtrls, Buttons, QRCtrls, QuickRpt, ExtDlgs, jpeg, wwdblook, Wwdbdlg,
  Oracle, DateUtils;

type
  TDesainKainFrm = class(TForm)
    TitlePanel: TPanel;
    Panel2: TPanel;
    PageControl1: TPageControl;
    TabSheet1: TTabSheet;
    TabSheet2: TTabSheet;
    Panel5: TPanel;
    wwDBGrid1: TwwDBGrid;
    dsCDSMaster: TwwDataSource;
    dsCDSDetail: TwwDataSource;
    LookRekananDlg: TwwLookupDialog;
    LookBarangDlg: TwwLookupDialog;
    dsQBrowse: TwwDataSource;
    LookBrowseDlg: TwwLookupDialog;
    Panel3: TPanel;
    Panel4: TPanel;
    DBText1: TDBText;
    Label4: TLabel;
    Label5: TLabel;
    wwDBDateTimePicker3: TwwDBDateTimePicker;
    DBMemo2: TDBMemo;
    Panel6: TPanel;
    DBText2: TDBText;
    Label13: TLabel;
    DBText4: TDBText;
    Label15: TLabel;
    Label14: TLabel;
    wwDBNavigator1: TwwDBNavigator;
    wwDBNavigator1Button2: TwwNavButton;
    wwDBNavigator1Button1: TwwNavButton;
    wwDBNavigator1Insert: TwwNavButton;
    wwDBNavigator1Delete: TwwNavButton;
    wwDBNavigator1Edit: TwwNavButton;
    wwDBNavigator1Post: TwwNavButton;
    wwDBNavigator1Cancel: TwwNavButton;
    wwDBNavigator1Button: TwwNavButton;
    BitBtnPosting: TBitBtn;
    wwDBGrid2: TwwDBGrid;
    Panel7: TPanel;
    CBPreview: TCheckBox;
    wwDBEdit3: TwwDBEdit;
    Label28: TLabel;
    QMaster: TOracleDataSet;
    CDSQDetail: TOracleDataSet;
    BitBtn4: TBitBtn;
    QBrowse: TOracleDataSet;
    QBarang: TOracleDataSet;
    QSubTotal: TOracleDataSet;
    QSubTotalSUB_TOTAL: TFloatField;
    LookArah: TwwDBComboBox;
    LookBeam: TwwDBComboDlg;
    wwDBComboDlg1: TwwDBComboDlg;
    Label2: TLabel;
    Label3: TLabel;
    LookKonstruksiDlg: TwwLookupDialog;
    LookCorakDlg: TwwLookupDialog;
    QBarangKD_ITEM: TStringField;
    QBarangNAMA_ITEM: TStringField;
    QBarangDISKRIPSI: TStringField;
    QBarangNO_PART: TStringField;
    QBarangJNS_BRG: TStringField;
    wwDBEdit1: TwwDBEdit;
    Label1: TLabel;
    Label16: TLabel;
    wwDBEdit7: TwwDBEdit;
    Label23: TLabel;
    OpenPictureDialog1: TOpenPictureDialog;
    QBarangRASIO: TFloatField;
    QBarangRASIO2: TFloatField;
    QBarangRASIO3: TFloatField;
    QBarangRASIO_CONES: TFloatField;
    QBarangRASIO_PALLET: TFloatField;
    QBarangHELAI: TFloatField;
    QBarangNO_BENANG: TFloatField;
    QDimPakan: TOracleDataSet;
    QDimPakanPAKAN: TFloatField;
    QSubTotal2: TOracleDataSet;
    QSubTotal2PANJANG: TFloatField;
    QSubTotal2BM: TFloatField;
    QSubTotal2WASTE: TFloatField;
    QSubTotal2QTY: TFloatField;
    QLusi: TOracleDataSet;
    QLusiLUSI: TFloatField;
    QLusiPANJANG: TFloatField;
    QLusiBERAT: TFloatField;
    QDimPakanPANJANG: TFloatField;
    QDimPakanBERAT: TFloatField;
    QTepi: TOracleDataSet;
    dsQDimPakan: TwwDataSource;
    dsQLusi: TwwDataSource;
    dsQTepi: TwwDataSource;
    QTepiTEPI: TFloatField;
    QTepiHELAI: TFloatField;
    QTepiPANJANG: TFloatField;
    QTepiBERAT: TFloatField;
    QLusiHELAI: TFloatField;
    QDimPakanHELAI: TFloatField;
    LookWarna: TwwDBLookupComboDlg;
    wwDBEdit18: TwwDBEdit;
    Label6: TLabel;
    DBText7: TDBText;
    DBText8: TDBText;
    Label25: TLabel;
    wwDBEdit19: TwwDBEdit;
    wwDBEdit20: TwwDBEdit;
    Label26: TLabel;
    Label27: TLabel;
    Label29: TLabel;
    Label30: TLabel;
    Label31: TLabel;
    LookKelompok: TwwDBComboBox;
    QuickRep1: TQuickRep;
    PageHeaderBand1: TQRBand;
    TitleBand1: TQRBand;
    QRTitle: TQRLabel;
    QRLabel1: TQRLabel;
    QRLabel2: TQRLabel;
    QRLabel5: TQRLabel;
    QRDBText2: TQRDBText;
    QRDBText10: TQRDBText;
    QRDBText11: TQRDBText;
    QRLabel4: TQRLabel;
    QRDBText5: TQRDBText;
    ColumnHeaderBand1: TQRBand;
    QRLabel11: TQRLabel;
    QRLabel12: TQRLabel;
    QRLabel13: TQRLabel;
    QRLabel7: TQRLabel;
    DetailBand1: TQRBand;
    QRDBText18: TQRDBText;
    QRDBMyList: TQRDBText;
    QRDBText8: TQRDBText;
    QRShape1: TQRShape;
    QRLNo: TQRLabel;
    PageFooterBand1: TQRBand;
    QRLabel19: TQRLabel;
    QRDBText20: TQRDBText;
    QRDBText21: TQRDBText;
    QRSysData2: TQRSysData;
    QRSysData3: TQRSysData;
    QRBand1: TQRBand;
    QRBand2: TQRBand;
    QRGroup1: TQRGroup;
    QRDBArah: TQRDBText;
    QRShape3: TQRShape;
    QRGroup2: TQRGroup;
    QRDBKelompok: TQRDBText;
    QRShape2: TQRShape;
    BitBtnPrint: TBitBtn;
    QRDBText3: TQRDBText;
    CDSQDetail2: TOracleDataSet;
    CDSQDetail3: TOracleDataSet;
    SummaryBand1: TQRBand;
    QRRichText1: TQRRichText;
    QRLabel3: TQRLabel;
    Button1: TButton;
    CDSQDetail4: TOracleDataSet;
    QHapus: TOracleQuery;
    QRExpr2: TQRExpr;
    QRLabel6: TQRLabel;
    QRLabel8: TQRLabel;
    CDSQDetail3ARAH: TStringField;
    CDSQDetail3KD_WARNA: TStringField;
    CDSQDetail3WARNA: TStringField;
    CDSQDetail3NHELAI: TStringField;
    CDSQDetail5: TOracleDataSet;
    Button2: TButton;
    QHitung: TOracleQuery;
    Label7: TLabel;
    Label8: TLabel;
    Label9: TLabel;
    Label10: TLabel;
    Label11: TLabel;
    wwDBEdit2: TwwDBEdit;
    wwDBEdit4: TwwDBEdit;
    wwDBEdit5: TwwDBEdit;
    wwDBEdit6: TwwDBEdit;
    wwDBEdit8: TwwDBEdit;
    Label18: TLabel;
    Label20: TLabel;
    Label21: TLabel;
    wwDBEdit16: TwwDBEdit;
    Label17: TLabel;
    wwDBEdit17: TwwDBEdit;
    Label22: TLabel;
    wwDBEdit10: TwwDBEdit;
    Label24: TLabel;
    wwDBEdit11: TwwDBEdit;
    Label12: TLabel;
    dsCDSQDetail5: TwwDataSource;
    Label32: TLabel;
    wwDBEdit12: TwwDBEdit;
    QRDBText1: TQRDBText;
    QRLabel9: TQRLabel;
    QRLabel10: TQRLabel;
    QRLabel14: TQRLabel;
    QRDBText6: TQRDBText;
    QRLabel15: TQRLabel;
    QRDBText7: TQRDBText;
    QRLabel16: TQRLabel;
    QRDBText9: TQRDBText;
    QRLabel17: TQRLabel;
    QRDBText12: TQRDBText;
    QRDBText4: TQRDBText;
    CDSQDetail6: TOracleDataSet;
    CDSQDetail6KD_ITEM: TStringField;
    CDSQDetail6NAMA_ITEM: TStringField;
    CDSQDetail6KD_WARNA: TStringField;
    CDSQDetail6WARNA: TStringField;
    CDSQDetail6NHELAI: TStringField;
    BitBtn6: TBitBtn;
    CheckBox1kain: TCheckBox;
    CDSQDetail7: TOracleDataSet;
    QRDBText13: TQRDBText;
    QRDBText14: TQRDBText;
    RadioGroup1: TRadioGroup;
    QRDBText15: TQRDBText;
    QRLabel18: TQRLabel;
    QRExpr1: TQRExpr;
    wwDBEdit13: TwwDBEdit;
    Label33: TLabel;
    QRDBText16: TQRDBText;
    QRExpr3: TQRExpr;
    CDSQDetail8: TOracleDataSet;
    DBText5: TDBText;
    GroupBox1: TGroupBox;
    Label34: TLabel;
    VTglAwal: TwwDBDateTimePicker;
    vTglAkhir: TwwDBDateTimePicker;
    cbOtomatis: TCheckBox;
    dbcField: TwwDBComboBox;
    vOperand: TLabel;
    ECari: TEdit;
    cbTanggal: TCheckBox;
    BitBtn1: TBitBtn;
    LRecords: TLabel;
    Label35: TLabel;
    Label36: TLabel;
    QKP: TOracleDataSet;
    QKPKP: TStringField;
    QKPLUSI: TStringField;
    QKPPAKAN: TStringField;
    QKPSISIR: TFloatField;
    QKPPICK: TFloatField;
    QKPLCUCUK: TFloatField;
    LookKP: TwwDBLookupComboDlg;
    QKonversi: TOracleDataSet;
    QKonversiKODE: TStringField;
    QKonversiKONSTRUKSI: TStringField;
    QKonversiARAH: TStringField;
    QKonversiBENANG: TStringField;
    QKonversiGRAM: TFloatField;
    dsQKonversi: TwwDataSource;
    LookKonversi: TwwDBLookupComboDlg;
    Ds_Qkp: TwwDataSource;
    wwDBEdit14: TwwDBEdit;
    QResep: TOracleDataSet;
    QResepNO_ORDER: TStringField;
    QResepJML: TFloatField;
    QHitung_resep: TOracleQuery;
    QMasterNO_DESAIN: TFloatField;
    QMasterISPOST: TStringField;
    QMasterNO_NOTA: TStringField;
    QMasterTGL3: TDateTimeField;
    QMasterNO_ORDER: TStringField;
    QMasterTGL_ORDER: TDateTimeField;
    QMasterKD_KONSTRUKSI: TStringField;
    QMasterKD_CORAK: TStringField;
    QMasterKETERANGAN: TStringField;
    QMasterMETER: TFloatField;
    QMasterRLUSI: TFloatField;
    QMasterRPAKAN: TFloatField;
    QMasterNLUSI_ORG: TFloatField;
    QMasterNTEPI: TFloatField;
    QMasterNKUKU: TFloatField;
    QMasterNLUSI: TFloatField;
    QMasterNPAKAN: TFloatField;
    QMasterDIM_LUSI: TFloatField;
    QMasterDIM_PAKAN: TFloatField;
    QMasterDIM_P: TFloatField;
    QMasterDIM_L: TFloatField;
    QMasterNKOTAK1: TFloatField;
    QMasterNKOTAK2: TFloatField;
    QMasterNSISIR: TFloatField;
    QMasterNPICK: TFloatField;
    QMasterVERSI: TStringField;
    QMasterTGL_INSERT2: TDateTimeField;
    QMasterOPR_INSERT: TStringField;
    QMasterGAMBAR2: TStringField;
    QMasterKONSTRUKSI: TStringField;
    QMasterCORAK: TStringField;
    QMasterTOLERANSI_WASTE2: TFloatField;
    QMasterSUSUT_LUSI: TFloatField;
    QMasterSUSUT_PAKAN: TFloatField;
    QMasterPROPORSI: TFloatField;
    QMasterTGL1_RENC_PROD: TDateTimeField;
    QMasterTGL2_RENC_PROD: TDateTimeField;
    QMasterKP2: TStringField;
    CDSQDetailNO_DESAIN: TFloatField;
    CDSQDetailARAH: TStringField;
    CDSQDetailKELOMPOK: TStringField;
    CDSQDetailKD_ITEM: TStringField;
    CDSQDetailNAMA_ITEM: TStringField;
    CDSQDetailKD_WARNA: TStringField;
    CDSQDetailWARNA: TStringField;
    CDSQDetailNO_BENANG: TFloatField;
    CDSQDetailRASIO: TFloatField;
    CDSQDetailNHELAI: TFloatField;
    CDSQDetailPKAIN: TFloatField;
    CDSQDetailPMETER: TFloatField;
    CDSQDetailKGKAIN: TFloatField;
    CDSQDetailKGMETER: TFloatField;
    CDSQDetailPWASTE: TFloatField;
    CDSQDetailKGWASTE: TFloatField;
    CDSQDetailPNET: TFloatField;
    CDSQDetailKGNET: TFloatField;
    CDSQDetailTHELAI: TFloatField;
    CDSQDetailPHELAI: TFloatField;
    CDSQDetailKGHELAI: TFloatField;
    CDSQDetailNO_URUT: TFloatField;
    CDSQDetailPTOTAL: TFloatField;
    CDSQDetailKGTOTAL: TFloatField;
    CDSQDetail7NHELAI: TFloatField;
    CDSQDetail7PKAIN: TFloatField;
    CDSQDetail7PMETER: TFloatField;
    CDSQDetail7PWASTE: TFloatField;
    CDSQDetail7PNET: TFloatField;
    CDSQDetail7KGKAIN: TFloatField;
    CDSQDetail7KGMETER: TFloatField;
    CDSQDetail7KGWASTE2: TFloatField;
    CDSQDetail7KGNET2: TFloatField;
    CDSQDetail5KD_ITEM: TStringField;
    CDSQDetail5NAMA_ITEM: TStringField;
    CDSQDetail5ARAH: TStringField;
    CDSQDetail5KD_WARNA: TStringField;
    CDSQDetail5WARNA: TStringField;
    CDSQDetail5NHELAI: TStringField;
    CDSQDetail5THELAI: TFloatField;
    CDSQDetail5PKAIN: TFloatField;
    CDSQDetail5PMETER: TFloatField;
    CDSQDetail5PWASTE: TFloatField;
    CDSQDetail5PNET: TFloatField;
    CDSQDetail5KGKAIN: TFloatField;
    CDSQDetail5KGMETER: TFloatField;
    CDSQDetail5KGWASTE: TFloatField;
    CDSQDetail5KGNET: TFloatField;
    CDSQDetail2NO_DESAIN: TFloatField;
    CDSQDetail2ARAH: TStringField;
    CDSQDetail2KELOMPOK: TStringField;
    CDSQDetail2KD_ITEM: TStringField;
    CDSQDetail2NAMA_ITEM: TStringField;
    CDSQDetail2KD_WARNA: TStringField;
    CDSQDetail2WARNA: TStringField;
    CDSQDetail2NO_BENANG: TFloatField;
    CDSQDetail2RASIO: TFloatField;
    CDSQDetail2NHELAI: TFloatField;
    CDSQDetail2PKAIN: TFloatField;
    CDSQDetail2PMETER: TFloatField;
    CDSQDetail2KGKAIN: TFloatField;
    CDSQDetail2KGMETER: TFloatField;
    CDSQDetail2PWASTE: TFloatField;
    CDSQDetail2KGWASTE: TFloatField;
    CDSQDetail2PNET: TFloatField;
    CDSQDetail2KGNET: TFloatField;
    CDSQDetail2THELAI: TFloatField;
    CDSQDetail2PHELAI: TFloatField;
    CDSQDetail2KGHELAI: TFloatField;
    CDSQDetail2NO_URUT: TFloatField;
    CDSQDetail2PTOTAL: TFloatField;
    CDSQDetail2KGTOTAL: TFloatField;
    CDSQDetail2RASIO2: TFloatField;
    CDSQDetail2THELAI2: TFloatField;
    CDSQDetail2KD_KONV: TStringField;
    CDSQDetail8NO_DESAIN: TFloatField;
    CDSQDetail8ARAH: TStringField;
    CDSQDetail8KELOMPOK: TStringField;
    CDSQDetail8KD_ITEM: TStringField;
    CDSQDetail8NAMA_ITEM: TStringField;
    CDSQDetail8KD_WARNA: TStringField;
    CDSQDetail8WARNA: TStringField;
    CDSQDetail8NO_BENANG: TFloatField;
    CDSQDetail8RASIO: TFloatField;
    CDSQDetail8NHELAI: TFloatField;
    CDSQDetail8PKAIN: TFloatField;
    CDSQDetail8PMETER: TFloatField;
    CDSQDetail8KGKAIN: TFloatField;
    CDSQDetail8KGMETER: TFloatField;
    CDSQDetail8PWASTE: TFloatField;
    CDSQDetail8KGWASTE: TFloatField;
    CDSQDetail8PNET: TFloatField;
    CDSQDetail8KGNET: TFloatField;
    CDSQDetail8THELAI: TFloatField;
    CDSQDetail8PHELAI: TFloatField;
    CDSQDetail8KGHELAI: TFloatField;
    CDSQDetail8NO_URUT: TFloatField;
    CDSQDetail8PTOTAL: TFloatField;
    CDSQDetail8KGTOTAL: TFloatField;
    CDSQDetail8RASIO2: TFloatField;
    CDSQDetail8THELAI2: TFloatField;
    CDSQDetail8KD_KONV: TStringField;
    QMasterISPOSTED: TStringField;
    CDSQDetail5KGTOTAL: TFloatField;
    CDSQDetail5PTOTAL: TFloatField;
    QBrowseNO_DESAIN: TFloatField;
    QBrowseNO_NOTA: TStringField;
    QBrowseTGL: TDateTimeField;
    QBrowseNO_ORDER: TStringField;
    QBrowseKETERANGAN: TStringField;
    QBrowseMETER: TFloatField;
    QBrowseDIM_P: TFloatField;
    QBrowseDIM_L: TFloatField;
    QBrowseNKOTAK1: TFloatField;
    QBrowseNKOTAK22: TFloatField;
    QBrowseNSISIR: TFloatField;
    QBrowseNPICK2: TFloatField;
    QBrowseVERSI2: TStringField;
    QBrowseKONSTRUKSI: TStringField;
    QBrowseCORAK: TStringField;
    QBrowseISPOST: TStringField;
    QBrowseTGL_ORDER: TDateTimeField;
    QBrowseGAMBAR: TStringField;
    QBrowseNLUSI: TFloatField;
    QBrowseNPAKAN2: TFloatField;
    QBrowseKP: TStringField;
    QBrowseKODI: TFloatField;
    QBrowsePCSKU: TFloatField;
    CDSQDetailRASIO2: TFloatField;
    CDSQDetailTHELAI2: TFloatField;
    CDSQDetailKD_KONV: TStringField;
    wwDBLookupComboDlg1: TwwDBLookupComboDlg;
    Label19: TLabel;
    wwDBEdit9: TwwDBEdit;
    QMasterNPAKAN2: TFloatField;
    CDSQDetail4NO_DESAIN: TFloatField;
    CDSQDetail4ARAH: TStringField;
    CDSQDetail4KELOMPOK2: TStringField;
    CDSQDetail4KD_ITEM: TStringField;
    CDSQDetail4NAMA_ITEM: TStringField;
    CDSQDetail4KD_WARNA: TStringField;
    CDSQDetail4WARNA2: TStringField;
    CDSQDetail4NO_BENANG: TFloatField;
    CDSQDetail4RASIO: TFloatField;
    CDSQDetail4NHELAI2: TFloatField;
    CDSQDetail4PKAIN: TFloatField;
    CDSQDetail4PMETER: TFloatField;
    CDSQDetail4KGKAIN: TFloatField;
    CDSQDetail4KGMETER: TFloatField;
    CDSQDetail4PWASTE: TFloatField;
    CDSQDetail4KGWASTE: TFloatField;
    CDSQDetail4PNET: TFloatField;
    CDSQDetail4KGNET: TFloatField;
    CDSQDetail4THELAI: TFloatField;
    CDSQDetail4PHELAI: TFloatField;
    CDSQDetail4KGHELAI: TFloatField;
    CDSQDetail4NO_URUT: TFloatField;
    CDSQDetail4PTOTAL: TFloatField;
    CDSQDetail4KGTOTAL: TFloatField;
    CDSQDetail4RASIO2: TFloatField;
    CDSQDetail4THELAI2: TFloatField;
    CDSQDetail4KD_KONV: TStringField;
    QMasterJMLC: TFloatField;
    Label37: TLabel;
    wwDBEdit15: TwwDBEdit;
    Label38: TLabel;
    wwDBEdit21: TwwDBEdit;
    QMasterNSPRING: TFloatField;
    CDSQDetailNSPRING: TFloatField;
    CDSQDetail4NSPRING: TFloatField;
    QKPKETERANGAN: TStringField;
    TabSheet6: TTabSheet;
    Panel8: TPanel;
    vOperand1: TLabel;
    BitBtn2: TBitBtn;
    GroupBox2: TGroupBox;
    Label40: TLabel;
    vTglAwal1: TwwDBDateTimePicker;
    vTglAkhir1: TwwDBDateTimePicker;
    cbOtomatis1: TCheckBox;
    dbcField1: TwwDBComboBox;
    ECari1: TEdit;
    cbTanggal1: TCheckBox;
    BitBtn3: TBitBtn;
    wwDBGrid5: TwwDBGrid;
    QLokasiResep1: TOracleDataSet;
  {  FloatField1: TFloatField;
    StringField1: TStringField;
    DateTimeField1: TDateTimeField;
    StringField2: TStringField;
    StringField3: TStringField;
    FloatField2: TFloatField;
    FloatField3: TFloatField;
    FloatField4: TFloatField;
    StringField7: TStringField;
    DateTimeField2: TDateTimeField;
    StringField8: TStringField;
    FloatField9: TFloatField;
    FloatField10: TFloatField;
    StringField9: TStringField;
    FloatField11: TFloatField;
    FloatField12: TFloatField;    }
    dsQLokasiResep1: TwwDataSource;
    QLokasiResep1NO_DESAIN: TFloatField;
    QLokasiResep1NO_NOTA: TStringField;
    QLokasiResep1TGL: TDateTimeField;
    QLokasiResep1NO_ORDER: TStringField;
    QLokasiResep1KETERANGAN: TStringField;
    QLokasiResep1METER: TFloatField;
    QLokasiResep1VERSI: TStringField;
    QLokasiResep1KONSTRUKSI: TStringField;
    QLokasiResep1CORAK: TStringField;
    QLokasiResep1ISPOST: TStringField;
    QLokasiResep1TGL_ORDER: TDateTimeField;
    QLokasiResep1KP: TStringField;
    QLokasiResep1TANGGAL: TDateTimeField;
    LookTambahan: TwwDBLookupComboDlg;
    Label39: TLabel;
    QJns_Beam: TOracleDataSet;
    QJns_BeamNAMA_MESIN: TStringField;
    QJns_BeamKD_MESIN: TStringField;
    QJns_BeamKELOMPOK: TStringField;
    QMasterBEAM: TStringField;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure wwDBGrid2Enter(Sender: TObject);
    procedure TabSheet1Show(Sender: TObject);
    procedure QMasterBeforeEdit(DataSet: TDataSet);
    procedure QMasterCalcFields(DataSet: TDataSet);
    procedure CDSQDetailNewRecord(DataSet: TDataSet);
    procedure QMasterNewRecord(DataSet: TDataSet);
    procedure BitBtnPostingClick(Sender: TObject);
    procedure wwDBNavigator1ButtonClick(Sender: TObject);
    procedure wwDBLookupCombo1Enter(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure LookBarangCustomDlg(Sender: TObject);
    procedure BitBtn3Click(Sender: TObject);
    procedure wwDBGrid1DblClick(Sender: TObject);
    procedure BitBtn4Click(Sender: TObject);
    procedure BitBtnPrintClick(Sender: TObject);
    procedure TabSheet2Show(Sender: TObject);
    procedure LookRekananDlgUserButton1Click(Sender: TObject;
      LookupTable: TDataSet);
    procedure LookBarangDlgUserButton1Click(Sender: TObject;
      LookupTable: TDataSet);
    procedure TitleBand1BeforePrint(Sender: TQRCustomBand;
      var PrintBand: Boolean);
    procedure wwDBEdit4Exit(Sender: TObject);
    procedure QBrowseAfterScroll(DataSet: TDataSet);
    procedure QBrowseCalcFields(DataSet: TDataSet);
{  procedure TabSheet3Show(Sender: TObject);   }
    procedure LookBeamEnter(Sender: TObject);
    procedure LookBeamCustomDlg(Sender: TObject);
    procedure wwDBComboDlg1CustomDlg(Sender: TObject);
    procedure wwDBComboDlg1Enter(Sender: TObject);
    procedure LookBarangEnter(Sender: TObject);
    procedure QDimPakanBeforeQuery(Sender: TOracleDataSet);
    procedure LookWarnaEnter(Sender: TObject);
    procedure LookWarnaCloseUp(Sender: TObject; LookupTable,
  FillTable: TDataSet; modified: Boolean);
    procedure CDSQDetailBeforePost(DataSet: TDataSet);
{    procedure DetailBand1BeforePrint(Sender: TQRCustomBand;
//  var PrintBand: Boolean);
//    procedure QRGroup2BeforePrint(Sender: TQRCustomBand;
//      var PrintBand: Boolean);
//    procedure SummaryBand1BeforePrint(Sender: TQRCustomBand;
//      var PrintBand: Boolean);    }
    procedure QMasterAfterScroll(DataSet: TDataSet);
    procedure wwDBGrid2DblClick(Sender: TObject);
    procedure CDSQDetail5CalcFields(DataSet: TDataSet);
    procedure VTglAwalChange(Sender: TObject);
    procedure vTglAkhirChange(Sender: TObject);
    procedure cbTanggalClick(Sender: TObject);
    procedure cbOtomatisClick(Sender: TObject);
    procedure dbcFieldEnter(Sender: TObject);
    procedure vOperandClick(Sender: TObject);
    procedure ECariChange(Sender: TObject);
    procedure BitBtn1Click(Sender: TObject);
    procedure LookKPEnter(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure wwDBGrid2CalcCellColors(Sender: TObject; Field: TField;
      State: TGridDrawState; Highlight: Boolean; AFont: TFont;
      ABrush: TBrush);
    procedure wwDBGrid2UpdateFooter(Sender: TObject);
    procedure TabSheet5Show(Sender: TObject);
    procedure wwDBGrid1TitleButtonClick(Sender: TObject;
      AFieldName: String);
    procedure QResepBeforeQuery(Sender: TOracleDataSet);
    procedure Label32Click(Sender: TObject);
    procedure QMasterBeforePost(DataSet: TDataSet);
    procedure Button2Click(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure QMasterAfterPost(DataSet: TDataSet);
{//        procedure LookJnsMesinClick(Sender: TObject);
//    procedure wwDBComboDlg1Enter(Sender: TObject);
//    procedure wwDBComboDlg1CustomDlg(Sender: TObject);
//    procedure LookBarangEnter(Sender: TObject);   }

    procedure LookJnsMesinCloseUp(Sender: TObject; LookupTable,
      FillTable: TDataSet; modified: Boolean);
    procedure LookJnsMesinEnter(Sender: TObject);
    procedure wwDBLookupComboDlg1Enter(Sender: TObject);
    procedure wwDBLookupComboDlg1CloseUp(Sender: TObject; LookupTable,
      FillTable: TDataSet; modified: Boolean);
    procedure wwDBEdit18Change(Sender: TObject);
    procedure vTglAkhir1Change(Sender: TObject);
    procedure vTglAwal1Change(Sender: TObject);
    procedure ECari1Change(Sender: TObject);
    procedure cbTanggal1Click(Sender: TObject);
    procedure vOperand1Click(Sender: TObject);
    procedure dbcField1Enter(Sender: TObject);
    procedure cbOtomatis1Click(Sender: TObject);
   // procedure BitBtn3Click(Sender: TObject);
    procedure BitBtn2Click(Sender: TObject);
    procedure TabSheet6Show(Sender: TObject);
    procedure CheckBox1kainClick(Sender: TObject);
    procedure LookTambahanCloseUp(Sender: TObject; LookupTable,
      FillTable: TDataSet; modified: Boolean);
    procedure LookTambahanEnter(Sender: TObject);
    procedure QLokasiResep1ISPOSTChange(Sender: TField);

  private
    { Private declarations }
    visberubah : boolean;
    vregister, vnomer : integer;
    vkd_item, vnama_item, vkelompok, varah : String;
    vfilter, vorder, vfilter2 : String;
  public
    { Public declarations }
  end;

var
  DesainKainFrm: TDesainKainFrm;

procedure ShowForm;

implementation

uses DM, DesainResume, DesainRep, Pengulangan,DesainResumekain,
  Desain;

{$R *.dfm}

procedure ShowForm;
Begin
  DesainKainFrm:=TDesainKainFrm.Create(Application);
  DesainKainFrm.TitlePanel.Caption:='DESAIN KAIN';
  DesainResumeFrm:=TDesainResumeFrm.Create(Application);
  DesainKainFrm.Show;
{  DesainResumeFrm.Show;     }
end;


procedure TDesainKainFrm.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  {DesainResumeFrm.vcanclose:=True;
  DesainResumeFrm.Close;   }
  Action:=caFree;
  DesainKainFrm:=Nil;
end;

procedure TDesainKainFrm.wwDBGrid2Enter(Sender: TObject);
begin
  if QMaster.State<>dsBrowse then
      QMaster.Post;
  vregister:=QMasterNO_DESAIN.AsInteger;
   CDSQDetailNO_URUT.AsInteger:=0;
end;

procedure TDesainKainFrm.TabSheet1Show(Sender: TObject);
begin
    BitBtnPrint.Visible:=TRUE;
    QMaster.Close;
    QMaster.SetVariable('no_desain',vregister);
    QMaster.Open;
    CDSQDetail.Open;
    wwDBEdit19.ReadOnly:=True;
    wwDBEdit21.ReadOnly:=True;
    wwDBEdit6.ReadOnly:=True;
    wwDBEdit9.ReadOnly:=True;
    wwDBEdit5.ReadOnly:=True;
end;

procedure TDesainKainFrm.QMasterBeforeEdit(DataSet: TDataSet);
begin
  visberubah:=True;
  if QMasterispost.AsString='1' then
  begin
      ShowMessage('Sudah di-POSTING !, tidak bisa di-EDIT...'+#13+'Hubungi Manajemen !');
      Abort;
  end;
end;

procedure TDesainKainFrm.QMasterCalcFields(DataSet: TDataSet);
begin
  if QMasterispost.AsString='1' then
    QMasterISPOSTED.AsString:='POSTED';
  BitBtnPosting.Enabled:=QMasterispost.AsString<>'1';
end;

procedure TDesainKainFrm.CDSQDetailNewRecord(DataSet: TDataSet);
begin
  visberubah:=True;
  CDSQDetailNO_DESAIN.AsInteger:=QMasterNO_DESAIN.AsInteger;
  if varah<>'' then CDSQDetailARAH.AsString:=varah;
  if vkd_item<>'' then CDSQDetailKD_ITEM.AsString:=vkd_item;
  if vnama_item<>'' then CDSQDetailNAMA_ITEM.AsString:=vnama_item;
  if vkelompok<>'' then CDSQDetailKELOMPOK.AsString:=vkelompok;

end;

procedure TDesainKainFrm.QMasterNewRecord(DataSet: TDataSet);
begin
{TabSheet1Show(nil);
DMFrm.QTime.Close;
DMFrm.QTime.Open; }
  QMasterispost.AsString:='0';
  QMasterNO_DESAIN.AsInteger:=0;
  QMasterTOLERANSI_WASTE2.AsFloat:=3.5;
{ QMastertgl.AsDateTime:=DMFrm.QUsertgl_login.AsDateTime; }
  QMasterTGL3.AsDateTime:=DMFrm.QTimeJAM.AsDateTime;
{  DMFrm.QTimeJAM.AsDateTime; }
  QMasterPROPORSI.AsFloat:=100;
end;

procedure TDesainKainFrm.BitBtnPostingClick(Sender: TObject);
var
  vno_nota : String;
begin
if wwDBEdit6.Text='00' then
begin
ShowMessage('Hitung jumlah Lusi dan Pakan dulu ya...');
Abort;
end;
  if QMasterispost.AsString='0' then
  begin
    if QMaster.State=dsBrowse then QMaster.Edit;
    QMasterispost.AsString:='1';
    QMasterNO_NOTA.AsString:=FormatFloat('0000',QMasterNO_DESAIN.AsInteger);
    ShowMessage('POSTING Sukses !');
  end;
end;

procedure TDesainKainFrm.wwDBNavigator1ButtonClick(Sender: TObject);
var
  vregister_str : string;
begin
  if InputQuery('Cari Nota','No. Register :',vregister_str) then
  begin
    try
      vregister:=StrToInt(vregister_str);
      TabSheet1Show(nil);
    except
      ShowMessage('Isi dengan ANGKA tanpa HURUF !');
    end;
  end;
end;

procedure TDesainKainFrm.wwDBLookupCombo1Enter(Sender: TObject);
begin
  DMFrm.QMU.Open;
end;

procedure TDesainKainFrm.FormCreate(Sender: TObject);
begin
  vregister:=-1;
  DMFrm.QLookPalekat.Close;
  QBarang.Close;
end;

procedure TDesainKainFrm.LookBarangCustomDlg(Sender: TObject);
var
  vno_part : String;
begin
  QBarang.Open;
  if LookBarangDlg.Execute then
  begin
     CDSQDetailkd_item.AsString:=QBarangkd_item.AsString;
{     CDSQDetailRASIO.AsFloat:=QBarangRASIO.AsFloat;  }
     CDSQDetailRASIO.AsFloat:=QBarangRASIO_CONES.AsFloat;
     CDSQDetailNO_BENANG.AsFloat:=QBarangNO_BENANG.AsFloat;
     CDSQDetailNAMA_ITEM.AsString:=QBarangNAMA_ITEM.AsString;
  end;
end;

//procedure TDesainKainFrm.BitBtn3Click(Sender: TObject);
//begin
{  LookBrowseDlg.Execute;  }
//end;

procedure TDesainKainFrm.wwDBGrid1DblClick(Sender: TObject);
begin
  TabSheet1.Show;
end;

procedure TDesainKainFrm.BitBtn4Click(Sender: TObject);
begin
    DMFrm.SaveDialog1.FileName:=TitlePanel.Caption+'.html';
    if DMFrm.SaveDialog1.Execute then
    begin
      try
        wwDBGrid1.ExportOptions.FileName:=DMFrm.SaveDialog1.FileName;
        wwDBGrid1.ExportOptions.TitleName:='<font size=4>'+TitlePanel.Caption+'</font><br><font size=1></font>';
        wwDBGrid1.ExportOptions.Save;
        if MessageDlg('Ekspor Data Sukses, Lihat Hasil ?',mtWarning,[mbYes, mbNo],0)=mrYes then
        begin
          DMFrm.LMDStarter1.Command:=DMFrm.SaveDialog1.FileName;
          DMFrm.LMDStarter1.Execute;
        end;
  		Except
    	  ShowMessage('Ekspor Data Gagal !');
  		end;
    end;

end;

procedure TDesainKainFrm.BitBtnPrintClick(Sender: TObject);
begin
  case RadioGroup1.ItemIndex of
  0 : begin
        CDSQDetail2.Close;
        CDSQDetail2.Open;
        CDSQDetail3.Close;
        CDSQDetail3.Open;
        CDSQDetail5.Close;
        CDSQDetail5.Open;
        CDSQDetail6.Close;
        CDSQDetail6.Open;
        if CDSQDetail2.RecordCount>25 then
        begin
           QuickRep1.Height:=1123;
        end
        else
        begin
          QuickRep1.Height:=2*1123;
        end;
        if CBPreview.Checked then
            QuickRep1.Preview
          else
          begin
      {      QuickRep1.PrinterSetup;    }
            QuickRep1.Print;
          end;
      end;
  1 : begin
        if CBPreview.Checked then
           begin
             DesainRepFrm:=TDesainRepFrm.Create(Self);
             DesainRepFrm.Preview;
             DesainRepFrm.Free;
           end
          else
           begin
             DesainRepFrm:=TDesainRepFrm.Create(Self);
             DesainRepFrm.Print;
             DesainRepFrm.Free;
           end;
        end;
  end;
end;

procedure TDesainKainFrm.TabSheet2Show(Sender: TObject);
begin
  BitBtnPrint.Visible:=FALSE;
{  BtnExport.Enabled:=True;  }
  vfilter:=' where (tgl>=to_date('''+FormatDateTime('dd/mm/yyyy',Date)+''',''dd/mm/yyyy'') and tgl<=(to_date('''+FormatDateTime('dd/mm/yyyy',Date)+''',''dd/mm/yyyy'')+1-1/86400))';
  QBrowse.Open;
end;

procedure TDesainKainFrm.LookRekananDlgUserButton1Click(Sender: TObject;
  LookupTable: TDataSet);
begin
  DMFrm.QLookPalekat.Close;
  DMFrm.QLookPalekat.Open;
end;

procedure TDesainKainFrm.LookBarangDlgUserButton1Click(Sender: TObject;
  LookupTable: TDataSet);
begin
   QBarang.Refresh;
end;

procedure TDesainKainFrm.TitleBand1BeforePrint(Sender: TQRCustomBand;
  var PrintBand: Boolean);
begin
  QRTitle.Caption:=TitlePanel.Caption;
end;

procedure TDesainKainFrm.wwDBEdit4Exit(Sender: TObject);
begin
  if BitBtnPosting.Enabled then BitBtnPosting.SetFocus;
end;

procedure TDesainKainFrm.QBrowseAfterScroll(DataSet: TDataSet);
begin
  vregister:=QBrowseNO_DESAIN.AsInteger;
  LRecords.Caption:='Data ke '+IntToStr(DataSet.RecNo)+' dari '+IntToStr(DataSet.RecordCount)+' data';
end;

procedure TDesainKainFrm.QBrowseCalcFields(DataSet: TDataSet);
begin
  case QBrowse.FieldByName('inc_ppn').AsInteger of
  0 : QBrowse.FieldByName('inc_ppnc').AsString:='-';
  1 : QBrowse.FieldByName('inc_ppnc').AsString:='INC';
  2 : QBrowse.FieldByName('inc_ppnc').AsString:='EXC';
  end;
end;

{procedure TDesain_kain_cobaFrm.TabSheet3Show(Sender: TObject);
var
  vfile : String;
begin
   Image1.Picture.Bitmap.Canvas.CleanupInstance;
   if (QMasterGAMBAR.AsString<>'') then
     vfile:=QMasterGAMBAR.AsString
     else
   if (QBrowseGAMBAR.AsString<>'') then
     vfile:=QBrowseGAMBAR.AsString
     else
       vfile:='';
   LFile.Caption:=vfile;
   try
     Image1.Picture.LoadFromFile(vfile);
   except
     ShowMessage('Foto tidak ditemukan !');
   end;
end;
 }
procedure TDesainKainFrm.LookBeamEnter(Sender: TObject);
begin
  DMFrm.QKonstruksi.Open;
end;

procedure TDesainKainFrm.LookBeamCustomDlg(Sender: TObject);
begin
  LookKonstruksiDlg.Execute;
  QMasterKD_KONSTRUKSI.AsString:=DMFrm.QKonstruksiKD_KONSTRUKSI.AsString;
  QMasterKONSTRUKSI.AsString:=DMFrm.QKonstruksiNAMA_KONSTRUKSI.AsString;
end;



procedure TDesainKainFrm.wwDBComboDlg1Enter(Sender: TObject);
begin
  DMFrm.QCorak_NS.Open;
end;


procedure TDesainKainFrm.QDimPakanBeforeQuery(Sender: TOracleDataSet);
begin
  QDimPakan.SetVariable('id_rab',QMasterNO_DESAIN.AsInteger);
end;

procedure TDesainKainFrm.LookWarnaEnter(Sender: TObject);
begin
if wwDBDateTimePicker3.Date >= StrToDate('01/01/2017') then
  begin
  //ShowMessage('tekan kene 44444');
    DMFrm.QWarna.Close;
    DMFrm.QWarna.DeclareVariable('porder', otSubst);
    DMFrm.QWarna.SQL.Text:='select a.*, a.rowid from ipisma_db3.warna_baru a :porder';
    DMFrm.QWarna.SetVariable('porder',' order by warna');
    DMFrm.QWarna.Open;
  end
  else
  begin
//  ShowMessage('tekan kene');
    DMFrm.QWarna.Close;
    DMFrm.QWarna.DeclareVariable('porder', otSubst);
    DMFrm.QWarna.SQL.Text:='select a.*, a.rowid from ipisma_db4.warna a :porder';
    DMFrm.QWarna.SetVariable('porder',' order by warna');
    DMFrm.QWarna.Open;
  end;
end;

procedure TDesainKainFrm.LookWarnaCloseUp(Sender: TObject; LookupTable,
  FillTable: TDataSet; modified: Boolean);
begin
//if wwDBDateTimePicker3.Date >= StrToDate('01/01/2017') then
//begin
 // if modified then
 //   CDSQDetailWARNA.AsString:=DMFrm.QWarnabaruWARNA.AsString;
//end
//else
//begin
  if modified then
    CDSQDetailWARNA.AsString:=DMFrm.QWarnaWARNA.AsString;
//end;
end;

procedure TDesainKainFrm.CDSQDetailBeforePost(DataSet: TDataSet);
begin
{  if CDSQDetailNSPRING.Asfloat=0 then
     begin
       ShowMessage('QTY Spring harus diisi Broooo!!!!!');
        Abort;
     end; }
  if (CDSQDetail.RecNo>0) and (CDSQDetailNO_URUT.AsInteger=0) then
    CDSQDetailNO_URUT.AsInteger:=CDSQDetail.RecNo;
  vkd_item:=CDSQDetailKD_ITEM.AsString;
  vnama_item:=CDSQDetailNAMA_ITEM.AsString;
  varah:=CDSQDetailARAH.AsString;
  vkelompok:=CDSQDetailKELOMPOK.AsString;
end;

{procedure TDesain_kain_cobaFrm.DetailBand1BeforePrint(Sender: TQRCustomBand;
  var PrintBand: Boolean);
begin
  vnomer:=vnomer+1;
  QRLNo.Caption:=IntToStr(vnomer);
end;
}{
procedure TDesain_kain_cobaFrm.QRGroup2BeforePrint(Sender: TQRCustomBand;
  var PrintBand: Boolean);
begin
  vnomer:=0;
end;
  }
{procedure TDesain_kain_cobaFrm.SummaryBand1BeforePrint(Sender: TQRCustomBand;
  var PrintBand: Boolean);
begin
  QRRichText1.Lines.Clear;
  QRRichText1.Lines.Add('TAMBAHAN');
  QRRichText1.Lines.Add('----------------');
  while not CDSQDetail3.Eof do
  begin
      QRRichText1.Lines.Add(copy(CDSQDetail3ARAH.AsString,4,10)+'	'+CDSQDetail3NHELAI.AsString+'	'+CDSQDetail3WARNA.AsString);
      CDSQDetail3.Next;
  end;
  QRRichText1.Lines.Add('----------------');
  QRRichText1.Lines.Add('RESUME ALL');
  QRRichText1.Lines.Add('----------------');
  while not CDSQDetail5.Eof do
  begin
      QRRichText1.Lines.Add(CDSQDetail5NAMA_ITEM.AsString+'	'+copy(CDSQDetail5ARAH.AsString,4,10)+'	'+CDSQDetail5NHELAI.AsString+'	'+CDSQDetail5WARNA.AsString);
      CDSQDetail5.Next;
  end;
  QRRichText1.Lines.Add('----------------');
  QRRichText1.Lines.Add('RESUME LUSI : '+CDSQDetail6NAMA_ITEM.AsString);
  QRRichText1.Lines.Add('----------------');
  while not CDSQDetail6.Eof do
  begin
      QRRichText1.Lines.Add(CDSQDetail6NHELAI.AsString+'	'+CDSQDetail6WARNA.AsString);
      CDSQDetail6.Next;
  end;
end;
}


procedure TDesainKainFrm.QMasterAfterScroll(DataSet: TDataSet);
begin
  wwDBGrid2UpdateFooter(nil);
end;

procedure TDesainKainFrm.wwDBGrid2DblClick(Sender: TObject);
var
  i, j : integer;
begin
   PengulanganFrm.wwDBSpinEdit1.Value:=CDSQDetail.RecNo;
   PengulanganFrm.wwDBSpinEdit2.Value:=CDSQDetail.RecordCount;
   PengulanganFrm.ShowModal;
   if PengulanganFrm.ModalResult=mrOK then
   begin
{        CDSQDetail.DisableControls;   }
        try
            CDSQDetail8.Close;
            CDSQDetail8.SetVariable('uawal',Round(PengulanganFrm.wwDBSpinEdit1.Value));
            CDSQDetail8.SetVariable('uakhir',Round(PengulanganFrm.wwDBSpinEdit2.Value));
            CDSQDetail8.SetVariable('no_desain',QMasterNO_DESAIN.AsInteger);
            CDSQDetail8.Open;
            i:=Round(PengulanganFrm.wwDBSpinEdit2.Value);
            for j:=1 to Round(PengulanganFrm.wwDBSpinEdit3.Value) do
            begin
                CDSQDetail8.First;
                while not CDSQDetail8.Eof do
                  begin
                      i:=i+1;
                      CDSQDetail.Insert;
                      CDSQDetailNO_URUT.AsInteger:=i;
                      CDSQDetailARAH.AsString:=CDSQDetail8ARAH.AsString;
                      CDSQDetailKELOMPOK.AsString:=CDSQDetail8KELOMPOK.AsString;
                      CDSQDetailKD_ITEM.AsString:=CDSQDetail8KD_ITEM.AsString;
                      CDSQDetailNAMA_ITEM.AsString:=CDSQDetail8NAMA_ITEM.AsString;
                      CDSQDetailKD_WARNA.AsString:=CDSQDetail8KD_WARNA.AsString;
                      CDSQDetailWARNA.AsString:=CDSQDetail8WARNA.AsString;
                      CDSQDetailNHELAI.AsString:=CDSQDetail8NHELAI.AsString;
                      CDSQDetail.Post;
                      CDSQDetail8.Next;
               end;
            end;
            CDSQDetail.Refresh;
            CDSQDetail.EnableControls;
            ShowMessage('Sukses !');
        except
        	  ShowMessage('Gagal !');
        end;
        CDSQDetail.EnableControls;
   end;
end;

procedure TDesainKainFrm.CDSQDetail5CalcFields(DataSet: TDataSet);
begin
CDSQDetail5PTOTAL.AsFloat:=CDSQDetail5PNET.AsFloat*QMasterMETER.AsInteger;
CDSQDetail5KGTOTAL.AsFloat:=CDSQDetail5KGNET.AsFloat*QMasterMETER.AsInteger;
 // CDSQDetail5PTOTAL.AsFloat:=CDSQDetail5PNET.AsFloat*QMasterJML_KODI.AsInteger;
 // CDSQDetail5KGTOTAL.AsFloat:=CDSQDetail5KGNET.AsFloat*QMasterJML_KODI.AsInteger;
end;

procedure TDesainKainFrm.VTglAwalChange(Sender: TObject);
begin
  vTglAkhir.Date:=Trunc(EndOfTheMonth(VTglAwal.Date));
end;

procedure TDesainKainFrm.vTglAkhirChange(Sender: TObject);
begin
  if VTglAwal.Date>vTglAkhir.Date then
  begin
      ShowMessage('Tanggal Akhir harus LEBIH BESAR dari Tanggal Awal !');
      vTglAkhir.Date:=VTglAwal.Date;
  end;

end;

procedure TDesainKainFrm.cbTanggalClick(Sender: TObject);
begin
  if cbTanggal.Checked then
  begin
    VTglAwal.Enabled:=cbTanggal.Checked;
    vTglAkhir.Enabled:=cbTanggal.Checked;
    VTglAwal.SetFocus;
  end
  else
    ECari.SetFocus;

end;

procedure TDesainKainFrm.cbOtomatisClick(Sender: TObject);
begin
  if cbOtomatis.Checked then
  begin
    ShowMessage('Mencari data pada kolom paling kiri.'+#13+'Urutkan data terlebih dahulu supaya mudah mencari !');
    wwDBGrid1.Options:=wwDBGrid1.Options+[dgAlwaysShowSelection];
  end
    else
    wwDBGrid1.Options:=wwDBGrid1.Options-[dgAlwaysShowSelection];
  ECari.SetFocus;

end;

procedure TDesainKainFrm.dbcFieldEnter(Sender: TObject);
var
  i : Word;
begin
  if (QBrowse.Active) and (dbcField.Items.Count=1) then
  for i:=0 to wwDBGrid1.FieldCount-1 do
    if UpperCase(wwDBGrid1.Columns[i].FieldName)<>'TANGGAL' then
      dbcField.Items.Add(wwDBGrid1.Columns[i].FieldName);

end;

procedure TDesainKainFrm.vOperandClick(Sender: TObject);
begin
  if vOperand.Caption='LIKE' then
    vOperand.Caption:='='
    else
      vOperand.Caption:='LIKE';

end;

procedure TDesainKainFrm.ECariChange(Sender: TObject);
begin
  if cbOtomatis.Checked then
  begin
      QBrowse.SearchRecord(wwDBGrid1.Columns[0].FieldName,ECari.Text,[srFromBeginning, srPartialMatch, srIgnoreCase]);
  end;

end;

procedure TDesainKainFrm.BitBtn1Click(Sender: TObject);
var
  i : word;
  vpertama : boolean;
begin
  vpertama:=True;
  if cbTanggal.Checked then
    vfilter:=' where (tgl>=to_date('''+FormatDateTime('dd/mm/yyyy',VTglAwal.Date)+''',''dd/mm/yyyy'') and tgl<=(to_date('''+FormatDateTime('dd/mm/yyyy',VTglAkhir.Date)+''',''dd/mm/yyyy'')+1-1/86400)) and ('
  else
    vfilter:=' where (';
  if (QBrowse.FieldCount>=1) then
  begin
    if dbcField.ItemIndex=0 then
    begin
      for i:=0 to wwDBGrid1.Selected.Count-1 do
 {   for i:=0 to QBrowse.FieldCount-1 do }
      begin
        if (QBrowse.FieldByName(wwDBGrid1.Columns[i].FieldName).FieldKind=fkData) and (UpperCase(wwDBGrid1.Columns[i].FieldName)<>'TGL') then
        begin
          if vpertama then
            begin
              if vOperand.Caption='LIKE' then
                vfilter:=vfilter+wwDBGrid1.Columns[i].FieldName+' like ''%'+ECari.Text+'%'''
                else
                   vfilter:=vfilter+wwDBGrid1.Columns[i].FieldName+' = '''+ECari.Text+'''';
              vpertama:=False;
            end
            else
              if vOperand.Caption='LIKE' then
                vfilter:=vfilter+' or '+wwDBGrid1.Columns[i].FieldName+' like ''%'+ECari.Text+'%'''
                else
                  vfilter:=vfilter+' or '+wwDBGrid1.Columns[i].FieldName+' = '''+ECari.Text+''''
        end;
      end;
    end
    else
      if vOperand.Caption='LIKE' then
         vfilter:=vfilter+dbcField.Text+' like ''%'+ECari.Text+'%'''
         else
           vfilter:=vfilter+dbcField.Text+' = '''+ECari.Text+'''';
    vfilter:=vfilter+')';
{   vorder:=' order by '+wwDBGrid1.Columns[0].FieldName;    }
    if QBrowse.Active then
      vorder:=' order by '+wwDBGrid1.Columns[0].FieldName
      else
        vorder:=' order by no_nota';

  end;
  QBrowse.DisableControls;
  QBrowse.Close;
  QBrowse.SetVariable('myparam',vfilter+vorder);
  QBrowse.Open;
  QBrowse.EnableControls;
end;

procedure TDesainKainFrm.LookKPEnter(Sender: TObject);
begin
  QKP.Open;
end;

procedure TDesainKainFrm.FormShow(Sender: TObject);
begin
  QKonversi.Open;
end;

procedure TDesainKainFrm.wwDBGrid2CalcCellColors(Sender: TObject;
  Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont;
  ABrush: TBrush);
begin
  if not Highlight then
  begin
      if (Field.FieldName='ARAH') or
         (Field.FieldName='KELOMPOK') or
         (Field.FieldName='NHELAI') or
         (Field.FieldName='KD_ITEM') then
      begin
        ABrush.Color:=clWhite;
        AFont.Color:=clBlack;
      end
        else
        begin
          ABrush.Color:=clYellow;
          AFont.Color:=clBlack;
        end;
  end;
end;

procedure TDesainKainFrm.wwDBGrid2UpdateFooter(Sender: TObject);
begin
  if CheckBox1kain.Checked then
  begin
  CDSQDetail5.Close;
  CDSQDetail5.Open;
  CDSQDetail7.Close;
  CDSQDetail7.Open;
    DesainResumekainFrm.wwDBGrid1.ColumnByName('thelai').FooterValue:=FormatFloat('#,#',DesainFrm.CDSQDetail7NHELAI.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('psarung').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7PSARUNG.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('pkodi').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7PKODI.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('pwaste').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7PWASTE.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('pnet').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7PNET.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('kgsarung').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7KGSARUNG.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('kgkodi').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7KGKODI.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('kgwaste').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7KGWASTE.AsFloat);
    DesainResumekainFrm.wwDBGrid1.ColumnByName('kgnet').FooterValue:=FormatFloat('#,#,0.00',DesainFrm.CDSQDetail7KGNET.AsFloat);
  end;

end;

procedure TDesainKainFrm.TabSheet5Show(Sender: TObject);
begin
QKP.Open;
end;

procedure TDesainKainFrm.wwDBGrid1TitleButtonClick(Sender: TObject;
  AFieldName: String);
begin
  if ((Sender as TwwDBGrid).ColumnByName(AFieldName).FieldName<>'') then
  begin
     if (Sender as TwwDBGrid).DataSource.DataSet.FieldByName(AFieldName).FieldKind=fkData then
        begin
          if vorder=' ASC' then
              vorder:=' DESC'
          else
              vorder:=' ASC';
          (Sender as TwwDBGrid).DataSource.DataSet.DisableControls;
          (Sender as TwwDBGrid).DataSource.DataSet.Close;
          ((Sender as TwwDBGrid).DataSource.DataSet as TOracleDataSet).SetVariable('myparam',vfilter+' order by '+(Sender as TwwDBGrid).ColumnByName(AFieldName).FieldName+vorder);
          (Sender as TwwDBGrid).DataSource.DataSet.Open;
          (Sender as TwwDBGrid).DataSource.DataSet.EnableControls;
        end
        else
          ShowMessage('Maaf, tidak bisa diurutkan menurut '+AFieldName+' !');
  end
  else
  ShowMessage('Maaf, tidak bisa diurutkan menurut '+AFieldName+' !');

end;

procedure TDesainKainFrm.QResepBeforeQuery(Sender: TOracleDataSet);
begin
  QResep.SetVariable('no_resep','%'+QMasterNO_ORDER.AsString+'%');
end;

procedure TDesainKainFrm.Label32Click(Sender: TObject);
begin
  QResep.Close;
  QResep.Open;
  if not QResep.IsEmpty then
    begin
        ShowMessage('No Resep '+QMasterNO_ORDER.AsString+' SUDAH ADA !');
    end;
end;

procedure TDesainKainFrm.QMasterBeforePost(DataSet: TDataSet);
begin
  QResep.Close;
  QResep.Open;
  if not QResep.IsEmpty then
    begin
        ShowMessage('No Resep '+QMasterNO_ORDER.AsString+' SUDAH ADA !');
        Abort;
    end;
end;

procedure TDesainKainFrm.Button2Click(Sender: TObject);
begin
  if QMaster.State<>dsBrowse then
      QMaster.Post;
  vregister:=QMasterNO_DESAIN.AsInteger;
  QHitung.Close;
  QHitung.SetVariable('nkotak1',QMasterNKOTAK1.AsInteger);
  QHitung.SetVariable('nkotak2',QMasterNKOTAK2.AsInteger);
  QHitung.SetVariable('no_desain',QMasterNO_DESAIN.AsInteger);
  QHitung.Execute;
  TabSheet1Show(nil);
end;

procedure TDesainKainFrm.Button1Click(Sender: TObject);
var
  i : integer;
begin

  QHapus.Close;
  QHapus.SetVariable('no_desain',QMasterNO_DESAIN.AsInteger);
  QHapus.Execute;
  CDSQDetail4.Close;
  CDSQDetail4.SetVariable('no_desain',QMasterNO_DESAIN.AsInteger);
  CDSQDetail4.Open;
  //ShowMessage(CDSQDetail4NO_DESAIN.AsString);
  i:=0;
  CDSQDetail4.DisableControls;
  while not CDSQDetail4.Eof do
    begin
        i:=i+1;
        CDSQDetail.Insert;
        CDSQDetailNO_URUT.AsInteger:=i;
        CDSQDetailARAH.AsString:='2. PAKAN';
        //ShowMessage(CDSQDetail4NO_DESAIN.AsString+' 1');
        CDSQDetailKELOMPOK.AsString:=CDSQDetail4KELOMPOK2.AsString;
        CDSQDetailKD_ITEM.AsString:=CDSQDetail4KD_ITEM.AsString;
        CDSQDetailNAMA_ITEM.AsString:=CDSQDetail4NAMA_ITEM.AsString;
        CDSQDetailKD_WARNA.AsString:=CDSQDetail4KD_WARNA.AsString;
        CDSQDetailWARNA.AsString:=CDSQDetail4WARNA2.AsString;
        CDSQDetailNHELAI.AsInteger:=CDSQDetail4NHELAI2.AsInteger;
        //ShowMessage(CDSQDetail4NAMA_ITEM.AsString+' 2');
        CDSQDetail.Post;
        CDSQDetail4.Next;
    end;
  CDSQDetail4.EnableControls;
  CDSQDetail.Refresh;
end;

procedure TDesainKainFrm.QMasterAfterPost(DataSet: TDataSet);
begin
if BitBtnPosting.Enabled=False then
begin
QHitung_resep.Close;
QHitung_resep.SetVariable('pno_desain', wwDBEdit14.Text);
QHitung_resep.Execute;
end;
end;

procedure TDesainKainFrm.LookBarangEnter(Sender: TObject);
begin
  QBarang.Open;
end;



procedure TDesainKainFrm.wwDBComboDlg1CustomDlg(Sender: TObject);
begin
  LookCorakDlg.Execute;
  QMasterKD_CORAK.AsString:=DMFrm.QCorak_NSKD_CORAK.AsString;
  QMasterCORAK.AsString:=DMFrm.QCorak_NSNAMA_CORAK.AsString;
end;


procedure TDesainKainFrm.LookJnsMesinCloseUp(Sender: TObject;
  LookupTable, FillTable: TDataSet; modified: Boolean);
begin
  //QMasterKD_CORAK.AsString:=DMFrm.QCorakKD_CORAK.AsString;
  //QMasterCORAK.AsString:=DMFrm.QCorakNAMA_CORAK.AsString;
end;

procedure TDesainKainFrm.LookJnsMesinEnter(Sender: TObject);
begin
//DMFrm.QCorak.Open
end;

procedure TDesainKainFrm.wwDBLookupComboDlg1Enter(Sender: TObject);
begin
if wwDBDateTimePicker3.Date >= StrToDate('01/01/2017') then
begin
  QBarang.Close;
  QBarang.SQL.Text:='select a.* from ipisma_db4.vmaterial_baru a';
  QBarang.Open;
//  ShowMessage(QBarangRASIO.AsString);
//  ShowMessage(QBarangRASIO_CONES.AsString);
//  ShowMessage(QBarangNO_BENANG.AsString);
//  ShowMessage(QBarangNAMA_ITEM.AsString);
//  ShowMessage(QBarangkd_item.AsString);
   {  CDSQDetailkd_item.AsString:=QBarangkd_item.AsString;
     CDSQDetailRASIO.AsFloat:=QBarangRASIO.AsFloat;
     CDSQDetailRASIO.AsFloat:=QBarangRASIO_CONES.AsFloat;
     CDSQDetailNO_BENANG.AsFloat:=QBarangNO_BENANG.AsFloat;
     CDSQDetailNAMA_ITEM.AsString:=QBarangNAMA_ITEM.AsString;   }
end
else
begin
  QBarang.Close;
  QBarang.Open;
    {   CDSQDetailkd_item.AsString:=QBarangkd_item.AsString;
     CDSQDetailRASIO.AsFloat:=QBarangRASIO.AsFloat;
     CDSQDetailRASIO.AsFloat:=QBarangRASIO_CONES.AsFloat;
     CDSQDetailNO_BENANG.AsFloat:=QBarangNO_BENANG.AsFloat;
     CDSQDetailNAMA_ITEM.AsString:=QBarangNAMA_ITEM.AsString; }
  end;

end;

procedure TDesainKainFrm.wwDBLookupComboDlg1CloseUp(Sender: TObject;
  LookupTable, FillTable: TDataSet; modified: Boolean);
begin
     CDSQDetailkd_item.AsString:=QBarangkd_item.AsString;
     CDSQDetailRASIO.AsFloat:=QBarangRASIO.AsFloat;
     CDSQDetailRASIO.AsFloat:=QBarangRASIO_CONES.AsFloat;
     CDSQDetailNO_BENANG.AsFloat:=QBarangNO_BENANG.AsFloat;
     CDSQDetailNAMA_ITEM.AsString:=QBarangNAMA_ITEM.AsString;
end;

procedure TDesainKainFrm.wwDBEdit18Change(Sender: TObject);
begin
if wwDBEdit18.Text='' then
    wwDBEdit18.Text:=''
    else
QMasterDIM_P.AsFloat:= StrToFloat(wwdbedit18.Text)*100;
end;

procedure TDesainKainFrm.vTglAkhir1Change(Sender: TObject);
begin
  if VTglAwal1.Date>vTglAkhir1.Date then
  begin
      ShowMessage('Tanggal Akhir harus LEBIH BESAR dari Tanggal Awal !');
      vTglAkhir1.Date:=VTglAwal1.Date;
  end;
end;

procedure TDesainKainFrm.vTglAwal1Change(Sender: TObject);
begin
  vTglAkhir1.Date:=Trunc(EndOfTheMonth(VTglAwal1.Date));
end;

procedure TDesainKainFrm.ECari1Change(Sender: TObject);
begin
  if cbOtomatis1.Checked then
  begin
      QLokasiResep1.SearchRecord(wwDBGrid5.Columns[0].FieldName,ECari1.Text,[srFromBeginning, srPartialMatch, srIgnoreCase]);
  end;
end;

procedure TDesainKainFrm.cbTanggal1Click(Sender: TObject);
begin
  if cbTanggal1.Checked then
  begin
    VTglAwal1.Enabled:=cbTanggal1.Checked;
    vTglAkhir1.Enabled:=cbTanggal1.Checked;
    VTglAwal1.SetFocus;
  end
  else
    ECari1.SetFocus;
end;

procedure TDesainKainFrm.vOperand1Click(Sender: TObject);
begin
  if vOperand1.Caption='LIKE' then
    vOperand1.Caption:='='
    else
      vOperand1.Caption:='LIKE';
end;

procedure TDesainKainFrm.dbcField1Enter(Sender: TObject);
var
  i : Word;
begin
  if (QLokasiResep1.Active) and (dbcField1.Items.Count=1) then
  for i:=0 to wwDBGrid5.FieldCount-1 do
    if UpperCase(wwDBGrid5.Columns[i].FieldName)<>'TANGGAL' then
      dbcField1.Items.Add(wwDBGrid5.Columns[i].FieldName);

end;

procedure TDesainKainFrm.cbOtomatis1Click(Sender: TObject);
begin
  if cbOtomatis1.Checked then
  begin
    ShowMessage('Mencari data pada kolom paling kiri.'+#13+'Urutkan data terlebih dahulu supaya mudah mencari !');
    wwDBGrid5.Options:=wwDBGrid5.Options+[dgAlwaysShowSelection];
  end
    else
    wwDBGrid5.Options:=wwDBGrid5.Options-[dgAlwaysShowSelection];
  ECari1.SetFocus;

end;

procedure TDesainKainFrm.BitBtn3Click(Sender: TObject);
var
  i : word;
  vpertama : boolean;
begin
  vpertama:=True;
  if cbTanggal1.Checked then
    vfilter:=' where (tgl>=to_date('''+FormatDateTime('dd/mm/yyyy',VTglAwal1.Date)+''',''dd/mm/yyyy'') and tgl<=(to_date('''+FormatDateTime('dd/mm/yyyy',VTglAkhir1.Date)+''',''dd/mm/yyyy'')+1-1/86400)) and ('
  else
    vfilter:=' where (';
  if (QLokasiResep1.FieldCount>=1) then
  begin
    if dbcField1.ItemIndex=0 then
    begin
      for i:=0 to wwDBGrid5.Selected.Count-1 do
  //    for i:=0 to QBrowse.FieldCount-1 do
      begin
        if (QLokasiResep1.FieldByName(wwDBGrid5.Columns[i].FieldName).FieldKind=fkData) and (UpperCase(wwDBGrid5.Columns[i].FieldName)<>'TGL') then
        begin
          if vpertama then
            begin
              if vOperand1.Caption='LIKE' then
                vfilter:=vfilter+wwDBGrid5.Columns[i].FieldName+' like ''%'+ECari1.Text+'%'''
                else
                   vfilter:=vfilter+wwDBGrid5.Columns[i].FieldName+' = '''+ECari1.Text+'''';
              vpertama:=False;
            end
            else
              if vOperand1.Caption='LIKE' then
                vfilter:=vfilter+' or '+wwDBGrid5.Columns[i].FieldName+' like ''%'+ECari1.Text+'%'''
                else
                  vfilter:=vfilter+' or '+wwDBGrid5.Columns[i].FieldName+' = '''+ECari1.Text+''''
        end;
      end;
    end
    else
      if vOperand1.Caption='LIKE' then
         vfilter:=vfilter+dbcField1.Text+' like ''%'+ECari1.Text+'%'''
         else
           vfilter:=vfilter+dbcField1.Text+' = '''+ECari1.Text+'''';
    vfilter:=vfilter+')';
//    vorder:=' order by '+wwDBGrid1.Columns[0].FieldName;
    if QLokasiResep1.Active then
      vorder:=' order by '+wwDBGrid5.Columns[0].FieldName
      else
        vorder:=' order by no_order';

  end;
  QLokasiResep1.DisableControls;
  QLokasiResep1.Close;
  QLokasiResep1.SetVariable('myparam',vfilter+vorder);
  QLokasiResep1.Open;
  QLokasiResep1.EnableControls;
end;

procedure TDesainKainFrm.BitBtn2Click(Sender: TObject);
begin
  if QLokasiResep1.Active then
  begin
     DMFrm.SaveDialog1.DefaultExt:='XLK';
     DMFrm.SaveDialog1.Filter:='Excel files (*.XLK)|*.XLK';
     DMFrm.SaveDialog1.FileName:='Lokasi Resep Kain';
     wwDBGrid5.ExportOptions.TitleName:='Lokasi Resep Kain';
       if DMFrm.SaveDialog1.Execute then
       begin
         try
         wwDBGrid5.ExportOptions.FileName:=DMFrm.SaveDialog1.FileName;
         wwDBGrid5.ExportOptions.Save;
         ShowMessage('Simpan Sukses !');
         except
         ShowMessage('Simpan Gagal !');
         end;
       end;
  end
  else
    ShowMessage('Tabel belum di-OPEN !');
end;

procedure TDesainKainFrm.TabSheet6Show(Sender: TObject);
begin
//BitBtnPrint.Visible:=FALSE;
{  BtnExport.Enabled:=True;  }
  vfilter:=' where (tgl>=to_date('''+FormatDateTime('dd/mm/yyyy',Date)+''',''dd/mm/yyyy'') and tgl<=(to_date('''+FormatDateTime('dd/mm/yyyy',Date)+''',''dd/mm/yyyy'')+1-1/86400))';
  QLokasiResep1.Open;
end;

procedure TDesainKainFrm.CheckBox1kainClick(Sender: TObject);
begin
  CDSQDetail.Refresh;
  CDSQDetail5.Close;
  CDSQDetail5.Open;
  CDSQDetail7.Close;
  CDSQDetail7.Open;
  if CheckBox1kain.Checked then
    //DesainResumekainFrm.Show


     else

      //DesainResumekainFrm.hide
end;

procedure TDesainKainFrm.LookTambahanCloseUp(Sender: TObject; LookupTable,
  FillTable: TDataSet; modified: Boolean);
begin
  QMasterBEAM.AsString:=QJns_BeamNAMA_MESIN.AsString;
end;

procedure TDesainKainFrm.LookTambahanEnter(Sender: TObject);
begin
QJns_Beam.Close;
QJns_Beam.Open;
end;


end.
